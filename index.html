<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Tracker | Cloud</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: { 
                extend: { 
                    colors: { 
                        notion: { bg: '#FFFFFF', darkbg: '#191919', hover: '#F1F1EF', darkhover: '#282828', border: '#E9E9E7', darkborder: '#2F2F2F', text: '#37352F', darktext: '#D4D4D4', gray: '#787774', darkgray: '#9B9A97' } 
                    } 
                } 
            }
        }
    </script>

    <style>
        body { font-family: 'Inter', sans-serif; }
        ::-webkit-scrollbar { width: 4px; height: 4px; }
        ::-webkit-scrollbar-thumb { background: #E1E1E1; border-radius: 4px; }
        .dark ::-webkit-scrollbar-thumb { background: #3A3A3A; }
        /* Prevent text wrapping on mobile for better row density */
        .truncate-cell { max-width: 120px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    </style>
</head>
<body class="bg-notion-bg text-notion-text dark:bg-notion-darkbg dark:text-notion-darktext transition-colors h-screen flex flex-col overflow-hidden">

    <div class="sticky top-0 z-40 bg-notion-bg/95 dark:bg-notion-darkbg/95 backdrop-blur-sm border-b border-notion-border dark:border-notion-darkborder px-4 md:px-12 py-2 shrink-0">
        <div class="max-w-[1200px] mx-auto flex justify-between items-center">
            <div class="flex items-center gap-1">
                <span class="text-xl md:text-2xl">ðŸ’¼</span>
                <h1 class="text-base md:text-xl font-bold">Tracker</h1>
            </div>
            <div class="flex gap-1 md:gap-2 text-xs md:text-sm">
                <button onclick="toggleTheme()" class="p-2 hover:bg-notion-hover dark:hover:bg-notion-darkhover rounded">ðŸŒ—</button>
                <button onclick="openModal()" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1.5 rounded font-medium shadow-sm">+ New</button>
            </div>
        </div>
    </div>

    <main class="flex-1 overflow-auto px-2 md:px-12 py-2 md:py-6">
        <div class="max-w-[1200px] mx-auto">
            <div class="border border-notion-border dark:border-notion-darkborder rounded-lg overflow-hidden">
                <table class="min-w-full divide-y divide-notion-border dark:divide-notion-darkborder">
                    <thead class="bg-notion-bg dark:bg-notion-darkbg sticky top-0 z-10">
                        <tr class="text-left text-[10px] md:text-xs text-notion-gray uppercase tracking-wider">
                            <th class="px-2 md:px-4 py-2 border-r dark:border-notion-darkborder">Company</th>
                            <th class="px-2 md:px-4 py-2 border-r dark:border-notion-darkborder">Pos.</th>
                            <th class="px-2 md:px-4 py-2 border-r dark:border-notion-darkborder">Status</th>
                            <th class="hidden md:table-cell px-4 py-2 border-r dark:border-notion-darkborder">Date</th>
                            <th class="px-2 md:px-4 py-2">Remark</th>
                        </tr>
                    </thead>
                    <tbody id="job-list" class="divide-y divide-notion-border dark:divide-notion-darkborder">
                        </tbody>
                </table>
            </div>
        </div>
    </main>

    <footer class="border-t border-notion-border dark:border-notion-darkborder bg-notion-bg dark:bg-notion-darkbg px-4 py-1 text-[10px] text-notion-gray flex justify-between">
        <div>Count: <span id="footer-count" class="font-medium ml-1">0</span></div>
        <button onclick="exportToPDF()" class="hover:underline">Export PDF</button>
    </footer>

    <div id="modal" class="fixed inset-0 z-50 bg-black/40 backdrop-blur-sm hidden flex items-center justify-center p-4 text-sm">
        <div class="bg-white dark:bg-[#202020] w-full max-w-lg rounded-xl shadow-2xl p-6">
            <form id="job-form" onsubmit="handleFormSubmit(event)" class="space-y-3">
                <input type="hidden" id="edit-id">
                <input type="text" id="company" placeholder="Company" required class="w-full bg-transparent border-b border-gray-200 dark:border-gray-700 py-1 outline-none text-lg font-bold">
                <div class="grid grid-cols-2 gap-3">
                    <input type="text" id="position" placeholder="Position" required class="bg-gray-50 dark:bg-notion-darkhover p-2 rounded outline-none">
                    <input type="number" id="salary" placeholder="Salary" class="bg-gray-50 dark:bg-notion-darkhover p-2 rounded outline-none">
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <select id="status" class="bg-gray-50 dark:bg-notion-darkhover p-2 rounded outline-none">
                        <option value="Applied">Applied</option>
                        <option value="Interviewed">Interviewed</option>
                        <option value="Offer">Offer</option>
                        <option value="Rejected">Rejected</option>
                    </select>
                    <input type="date" id="date" required class="bg-gray-50 dark:bg-notion-darkhover p-2 rounded outline-none">
                </div>
                <select id="remark" class="w-full bg-gray-50 dark:bg-notion-darkhover p-2 rounded outline-none">
                    <option value="">No Remark</option>
                    <option value="Waiting">Waiting</option>
                    <option value="Declined">Declined</option>
                </select>
                <div class="pt-2 flex justify-end gap-2">
                    <button type="button" onclick="closeModal()">Cancel</button>
                    <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded font-medium">Save</button>
                </div>
            </form>
        </div>
    </div>

 <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { 
        getFirestore, collection, addDoc, onSnapshot, query, orderBy, 
        doc, updateDoc, deleteDoc, enableIndexedDbPersistence 
    } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        // ... YOUR CONFIG HERE ...
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // --- NEW: ENABLE OFFLINE PERSISTENCE ---
    enableIndexedDbPersistence(db).catch((err) => {
        if (err.code == 'failed-precondition') {
            console.log("Persistence failed: Multiple tabs open");
        } else if (err.code == 'unimplemented-state') {
            console.log("Persistence is not supported by this browser");
        }
    });

    const colRef = collection(db, "jobs");

    // [Rest of your saveJob, openModal, and onSnapshot functions stay exactly the same]
    // ...
</script>
